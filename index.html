<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>時間単価・コスト可視化ツール</title>
  <style>
    :root{ --bg:#f5f8fb; --card:#ffffff; --ink:#1f2937; --muted:#6b7280; --accent:#3aa2c8; --accent-strong:#2384a8; --line:#e7eef3; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic","Meiryo",Arial,sans-serif; color:var(--ink); background:var(--bg);}   
    .container{max-width:1100px; margin:10px auto; padding:0 10px;} /* 余白圧縮 */
    header{display:flex; gap:6px; align-items:center; margin-bottom:6px;}
    .badge{background:linear-gradient(180deg,var(--accent),var(--accent-strong)); color:#fff; padding:3px 7px; border-radius:999px; font-size:10.5px;}
    h1{font-size:17px; margin:0; font-weight:700; letter-spacing:.3px; line-height:1.05;}
    @media (orientation:portrait){ h1{ font-size:14px; } }

    .grid{display:grid; grid-template-columns:1fr; gap:10px;}
    @media (min-width:900px){ .grid{grid-template-columns: 1.1fr 0.9fr;} }
    @media (max-width:899px) and (orientation: landscape){ .grid{grid-template-columns:1fr 1fr;} }

    .card{background:var(--card); border:1px solid var(--line); border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,.04);}    
    .section{padding:10px 10px 4px 10px; border-bottom:1px solid var(--line);}   
    .section:last-child{border-bottom:none; padding-bottom:10px;}
    .section h2{margin:0 0 4px 0; font-size:14px;}

    .help{font-size:11px; color:var(--muted);}    
    .row{display:grid; grid-template-columns:130px 1fr; gap:8px; align-items:center; padding:4px 0;} 
    .row + .row{border-top:1px dashed var(--line);}    
    .label{color:var(--muted); font-size:12px;}

    input[type="text"], input[type="number"], select{ width:100%; padding:7px 9px; font-size:13.5px; border-radius:9px; border:1px solid var(--line); background:#f9fbfd; outline:none; transition:border .15s, box-shadow .15s, background .15s; }
    input[type="text"]:focus, input[type="number"]:focus, select:focus{ border-color:var(--accent); box-shadow:0 0 0 3px rgba(58,162,200,.18); background:#fff; }

    /* スライダー（給与・所要時間） */
    .slider-row{display:grid; grid-template-columns:1fr; gap:3px;}
    input[type="range"]{ width:100%; height:26px; -webkit-appearance:none; appearance:none; background:transparent; }
    input[type="range"]::-webkit-slider-runnable-track{ height:6px; background:linear-gradient(90deg,var(--accent) 0%, var(--accent-strong) 100%); border-radius:999px; opacity:.35; }
    input[type="range"]::-moz-range-track{ height:6px; background:linear-gradient(90deg,var(--accent) 0%, var(--accent-strong) 100%); border-radius:999px; opacity:.35; }
    input[type="range"]::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:16px; height:16px; border-radius:50%; background:var(--accent-strong); margin-top:-5px; box-shadow:0 2px 6px rgba(0,0,0,.15); }
    input[type="range"]::-moz-range-thumb{ width:16px; height:16px; border-radius:50%; background:var(--accent-strong); box-shadow:0 2px 6px rgba(0,0,0,.15); border:none; }

    .seg{display:flex; gap:6px;}
    .seg button{flex:1; border:1px solid var(--line); background:#f3f7fb; color:#111; padding:6px 8px; border-radius:9px; cursor:pointer; font-weight:600; font-size:13.5px;}
    .seg button.active{background:linear-gradient(180deg,var(--accent),var(--accent-strong)); color:#fff; border-color:transparent;}

    .result{ display:grid; grid-template-columns:1fr; gap:8px; padding:10px; }
    .tile{border:1px solid var(--line); border-radius:9px; padding:8px; background:linear-gradient(180deg,#ffffff 0%, #f7fbfe 100%);}    
    .tile h3{margin:0 0 3px 0; font-size:12.5px; color:var(--muted);}    
    .main-figure{font-size:24px; font-weight:800; letter-spacing:.2px;}

    .btn{display:inline-flex; gap:6px; align-items:center; padding:7px 10px; background:linear-gradient(180deg,var(--accent),var(--accent-strong)); border:none; color:#fff; border-radius:9px; cursor:pointer; font-weight:700;}
    .btn.secondary{background:#eef5f9; color:var(--accent-strong); border:1px solid var(--line);} 

    .footer{font-size:11px; color:var(--muted); padding:6px 10px 10px;}
    .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:6px;}
    .hr{height:1px; background:var(--line); margin:6px 0;}

    .credit{ text-align:center; font-size:12px; color:#7b8794; padding:10px 0 12px; }
    .switch{ display:flex; align-items:center; gap:8px; }

    /* トースト */
    .toast{ position:fixed; left:8px; right:8px; bottom:8px; background:#111; color:#fff; padding:8px 10px; border-radius:8px; opacity:0.95; font-size:12px; z-index:9999; text-align:center; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <span class="badge">人件費の見える化</span>
      <h1>時間単価・コスト可視化ツール</h1>
    </header>

    <div class="grid">
      <!-- 左：入力 -->
      <div class="card">
        <div class="section">
          <h2>1) 入力</h2>
          <div class="row">
            <div class="label">給与の単位</div>
            <div class="seg" role="tablist" aria-label="給与の単位">
              <button id="btnMonthly" class="active" aria-selected="true">月給</button>
              <button id="btnYearly" aria-selected="false">年収</button>
              <button id="btnHourly" aria-selected="false">時給</button>
            </div>
          </div>
          <div class="row">
            <div class="label"><span id="salaryLabel">月給（税引前）</span></div>
            <div class="slider-row">
              <input id="salary" type="text" inputmode="numeric" placeholder="例：300,000" value="300,000" />
              <input id="salaryRange" type="range" min="100000" max="2000000" step="1000" />
            </div>
          </div>
          <div class="row">
            <div class="label">社保上乗せ</div>
            <div class="switch">
              <input id="overheadSoc" type="checkbox" />
              <label for="overheadSoc" class="help">社会保険の<b>事業主負担</b>を上乗せ（標準率を適用）</label>
            </div>
          </div>
        </div>

        <div class="section" id="monthlyBlock">
          <h2>2) 稼働時間（<span style="color:var(--accent-strong)">月給ベース</span>）</h2>
          <div class="row"><div class="label">月の稼働日数</div><input id="mDays" type="number" min="1" max="31" step="1" value="20" /></div>
          <div class="row"><div class="label">1日の労働時間</div><input id="mHoursPerDay" type="number" min="0.1" max="24" step="0.25" value="8" /></div>
          <div class="row"><div class="label">月の稼働時間</div><input id="mHours" type="number" min="1" step="1" value="160" /></div>
          <div class="help">※ 上の2項目を変更すると自動で再計算（手入力も可）。</div>
        </div>

        <div class="section" id="yearlyBlock" style="display:none">
          <h2>2) 稼働時間（<span style="color:var(--accent-strong)">年収ベース</span>）</h2>
          <div class="row"><div class="label">年間の稼働日数</div><input id="yDays" type="number" min="1" max="366" step="1" value="240" /></div>
          <div class="row"><div class="label">1日の労働時間</div><input id="yHoursPerDay" type="number" min="0.1" max="24" step="0.25" value="8" /></div>
          <div class="row"><div class="label">年間の稼働時間</div><input id="yHours" type="number" min="1" step="1" value="1920" /></div>
          <div class="help">※ 上の2項目を変更すると自動で再計算（手入力も可）。</div>
        </div>

        <div class="section">
          <h2>3) 所要時間</h2>
          <div class="row">
            <div class="label">所要時間（h）</div>
            <div class="slider-row">
              <input id="useHours" type="number" min="0" step="0.25" value="1.0" />
              <input id="useHoursRange" type="range" min="0" max="12" step="0.25" />
            </div>
          </div>
        </div>
      </div>

      <!-- 右：結果 -->
      <div class="card">
        <div class="section">
          <h2>結果</h2>
          <div class="result">
            <div class="tile">
              <h3>時間単価（税込/ベース×上乗せ率）</h3>
              <div class="main-figure" id="hourly">–</div>
              <div class="help">社保上乗せ率（標準）：<b id="socRateLabel">–</b></div>
              <div class="help">1分あたり：<b id="perMin">–</b></div>
            </div>

            <div class="tile">
              <h3>所要時間のコスト</h3>
              <div class="main-figure" id="cost">–</div>
              <div class="help">15分：<b id="c15">–</b> ／ 30分：<b id="c30">–</b> ／ 1時間：<b id="c60">–</b></div>
            </div>

            <div class="tile">
              <h3>前提（現在の設定）</h3>
              <div class="grid-2">
                <div>
                  <div class="help">給与ベース</div>
                  <div id="baseKind" style="font-weight:700">月給</div>
                </div>
                <div>
                  <div class="help">社保上乗せ</div>
                  <div id="vhOverheadSoc" style="font-weight:700">なし</div>
                </div>
              </div>
              <div class="hr"></div>
              <div class="grid-2">
                <div>
                  <div class="help">対象給与</div>
                  <div id="vhSalary" style="font-weight:700">–</div>
                </div>
                <div>
                  <div class="help">稼働時間（基準）</div>
                  <div id="vhWorkH" style="font-weight:700">–</div>
                </div>
              </div>
            </div>

            <div>
              <button id="copyBtn" class="btn" title="結果をクリップボードにコピー">コピー</button>
              <button id="resetBtn" class="btn secondary">リセット</button>
            </div>
          </div>
        </div>
        <div class="footer">
          <div class="note">※ このツールは、<b>単純な換算法</b>（時間単価＝給与÷稼働時間）に基づきます。労基法上の一般的な所定労働時間（1日8時間・週40時間）に合わせ、初期値を 8h×20日/月・8h×240日/年としてあります。また、社保上乗せは標準率を使用しており、実際の料率は保険者・業種・地域・年度等により異なります。</div>
        </div>
      </div>
    </div>

    <div class="credit"><span id="creditText"></span></div>
  </div>

<script>
// 初期化（DOMContentLoaded/即時の両対応）
(function(){
  let booted=false;
  function init(){
    if(booted) return; booted=true;
    try{
      const VERSION = 'r9';
      const SOC_RATE = 16.0; // 事業主負担の標準率（概算）
      const el = (id)=>document.getElementById(id);
      const fmtJPY = (n)=> new Intl.NumberFormat('ja-JP',{style:'currency', currency:'JPY', maximumFractionDigits:0}).format(n);

      const state = { mode:'monthly', salary:300000, overheadSoc:false, mDays:20, mHoursPerDay:8, mHours:160, yDays:240, yHoursPerDay:8, yHours:1920, useHours:1 };

      function showToast(msg){ const t=document.createElement('div'); t.className='toast'; t.textContent=msg; document.body.appendChild(t); setTimeout(()=>{ t.remove(); }, 1600); }
      function clamp(v,min,max){ v=Number(v)||0; if(v<min) v=min; if(v>max) v=max; return v; }
      function parseMoney(text){ const cleaned = String(text||'').replace(/[^0-9.]/g,''); return Number(cleaned||0); }
      function formatMoneyToInput(num){ const s=el('salary'); if(s) s.value = (Number(num)||0).toLocaleString('ja-JP'); }
      const monthlyHours=()=> Number(state.mHours)||0; const yearlyHours=()=> Number(state.yHours)||0; const baseSalary=()=> Number(state.salary)||0;
      const loadedSalary=()=> baseSalary() * (1 + (state.overheadSoc? SOC_RATE/100 : 0));
      function hourlyRate(){ // 時間単価（円/h）
        const denom = state.mode==='monthly' ? monthlyHours() : state.mode==='yearly' ? yearlyHours() : 1; // 時給は1時間で割る
        const rate= denom>0? loadedSalary()/denom:0; return Math.round(rate);
      }
      const costFor=(h)=> Math.round(hourlyRate()*(Number(h)||0));

      function syncSalaryRange(){
        const r=el('salaryRange'); if(!r) return;
        if(state.mode==='monthly'){ r.min=100000; r.max=2000000; r.step=1000; }
        else if(state.mode==='yearly'){ r.min=1000000; r.max=30000000; r.step=10000; }
        else { /* 時給 */ r.min=800; r.max=10000; r.step=10; }
        r.value=String(baseSalary());
      }
      function syncUseHoursRange(){ const r=el('useHoursRange'); if(!r) return; r.min=0; r.max=12; r.step=0.25; r.value=String(state.useHours||0); }

      function updateVisibility(){
        // 2) 稼働時間の表示制御：時給のときは非表示
        el('monthlyBlock').style.display = state.mode==='monthly'? '' : 'none';
        el('yearlyBlock').style.display  = state.mode==='yearly' ? '' : 'none';
      }

      function updateView(){
        el('salaryLabel').textContent = state.mode==='monthly'? '月給（税引前）' : state.mode==='yearly'? '年収（税引前）' : '時給（税引前）';
        el('baseKind').textContent = state.mode==='monthly'? '月給' : state.mode==='yearly'? '年収' : '時給';
        el('vhOverheadSoc').textContent = state.overheadSoc ? `あり（${SOC_RATE}%）` : 'なし';
        el('socRateLabel').textContent = `${SOC_RATE}%`;
        formatMoneyToInput(baseSalary());
        syncSalaryRange();
        syncUseHoursRange();
        updateVisibility();
        el('vhSalary').textContent = fmtJPY(baseSalary());
        const wh = state.mode==='monthly'? monthlyHours() : state.mode==='yearly'? yearlyHours() : null;
        el('vhWorkH').textContent = (wh==null)? '—' : (wh.toLocaleString('ja-JP') + ' 時間/' + (state.mode==='monthly'? '月':'年'));
        const h = hourlyRate();
        el('hourly').textContent = fmtJPY(h) + ' / 時間';
        el('perMin').textContent = fmtJPY(Math.round(h/60));
        const useH = Number(state.useHours)||0;
        el('cost').textContent = fmtJPY(costFor(useH));
        el('c15').textContent = fmtJPY(costFor(0.25));
        el('c30').textContent = fmtJPY(costFor(0.5));
        el('c60').textContent = fmtJPY(costFor(1));
        el('btnMonthly').classList.toggle('active', state.mode==='monthly');
        el('btnYearly').classList.toggle('active', state.mode==='yearly');
        el('btnHourly').classList.toggle('active', state.mode==='hourly');
      }

      function copySummary(){
        const base = state.mode==='monthly'? '月給' : state.mode==='yearly'? '年収' : '時給';
        const workLine = state.mode==='monthly' ? `稼働時間：${state.mHours.toLocaleString('ja-JP')} 時間/月` : state.mode==='yearly' ? `稼働時間：${state.yHours.toLocaleString('ja-JP')} 時間/年` : `稼働時間：—（時給ベース）`;
        const txt=[`【時間単価・コスト可視化】`,`給与ベース：${base}`,`対象給与：${fmtJPY(baseSalary())}`,
          `社保上乗せ：${state.overheadSoc?`あり（${SOC_RATE}%）`:'なし'}`,
          workLine,
          `時間単価：${fmtJPY(hourlyRate())} /h`,`1分あたり：${fmtJPY(Math.round(hourlyRate()/60))}`,
          `15分：${fmtJPY(costFor(0.25))} ／ 30分：${fmtJPY(costFor(0.5))} ／ 1時間：${fmtJPY(costFor(1))}`,`(ver ${VERSION})`].join('
');
        if(navigator.clipboard && navigator.clipboard.writeText){
          navigator.clipboard.writeText(txt).then(()=>{ showToast('コピーしました'); }).catch(()=>{
            const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); showToast('コピーしました');
          });
        }else{
          const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); showToast('コピーしました');
        }
      }

      function resetAll(){
        Object.assign(state,{mode:'monthly', salary:300000, overheadSoc:false, mDays:20, mHoursPerDay:8, mHours:160, yDays:240, yHoursPerDay:8, yHours:1920, useHours:1});
        formatMoneyToInput(state.salary); el('overheadSoc').checked=false; el('mDays').value='20'; el('mHoursPerDay').value='8'; el('mHours').value='160'; el('yDays').value='240'; el('yHoursPerDay').value='8'; el('yHours').value='1920'; el('useHours').value='1.0'; syncUseHoursRange(); updateView(); save(); showToast('リセットしました');
      }

      // events
      el('btnMonthly').addEventListener('click', ()=>{ state.mode='monthly'; updateView(); save(); });
      el('btnYearly').addEventListener('click', ()=>{ state.mode='yearly'; updateView(); save(); });
      el('btnHourly').addEventListener('click', ()=>{ state.mode='hourly'; updateView(); save(); });

      el('salary').addEventListener('input', (e)=>{ state.salary=parseMoney(e.target.value); el('salaryRange').value=String(baseSalary()); updateView(); save(); });
      el('salary').addEventListener('blur', ()=>{ formatMoneyToInput(baseSalary()); });
      el('salaryRange').addEventListener('input', (e)=>{ state.salary=Number(e.target.value)||0; formatMoneyToInput(baseSalary()); updateView(); save(); });
      el('overheadSoc').addEventListener('change', (e)=>{ state.overheadSoc=!!e.target.checked; updateView(); save(); });

      const recalcMonthly=()=>{ state.mDays=clamp(state.mDays,1,31); state.mHoursPerDay=clamp(state.mHoursPerDay,0.1,24); state.mHours=(Number(state.mDays)||0)*(Number(state.mHoursPerDay)||0); el('mHours').value=state.mHours; };
      el('mDays').addEventListener('input',(e)=>{ state.mDays=clamp(e.target.value,1,31); e.target.value=state.mDays; recalcMonthly(); updateView(); save(); });
      el('mHoursPerDay').addEventListener('input',(e)=>{ state.mHoursPerDay=clamp(e.target.value,0.1,24); e.target.value=state.mHoursPerDay; recalcMonthly(); updateView(); save(); });
      el('mHours').addEventListener('input',(e)=>{ state.mHours=Number(e.target.value)||0; updateView(); save(); });

      const recalcYearly=()=>{ state.yDays=clamp(state.yDays,1,366); state.yHoursPerDay=clamp(state.yHoursPerDay,0.1,24); state.yHours=(Number(state.yDays)||0)*(Number(state.yHoursPerDay)||0); el('yHours').value=state.yHours; };
      el('yDays').addEventListener('input',(e)=>{ state.yDays=clamp(e.target.value,1,366); e.target.value=state.yDays; recalcYearly(); updateView(); save(); });
      el('yHoursPerDay').addEventListener('input',(e)=>{ state.yHoursPerDay=clamp(e.target.value,0.1,24); e.target.value=state.yHoursPerDay; recalcYearly(); updateView(); save(); });
      el('yHours').addEventListener('input',(e)=>{ state.yHours=Number(e.target.value)||0; updateView(); save(); });

      // 所要時間：数値入力とスライダーの双方向連動
      el('useHours').addEventListener('input', (e)=>{ state.useHours=Number(e.target.value)||0; const r=el('useHoursRange'); if(r) r.value=String(state.useHours); updateView(); save(); });
      el('useHoursRange').addEventListener('input', (e)=>{ state.useHours=Number(e.target.value)||0; el('useHours').value=String(state.useHours); updateView(); save(); });

      el('copyBtn').addEventListener('click', copySummary);
      el('resetBtn').addEventListener('click', resetAll);

      // persist
      const KEY='rate_tool_r9';
      function save(){ try{ localStorage.setItem(KEY, JSON.stringify(state)); }catch(e){} }
      function load(){ try{ const s = JSON.parse(localStorage.getItem(KEY)||localStorage.getItem('rate_tool_r8')||'null'); if(s){ Object.assign(state,s); } }catch(e){} }

      // init
      load();
      formatMoneyToInput(state.salary);
      el('overheadSoc').checked=!!state.overheadSoc;
      el('mDays').value=state.mDays; el('mHoursPerDay').value=state.mHoursPerDay; el('mHours').value=state.mHours;
      el('yDays').value=state.yDays; el('yHoursPerDay').value=state.yHoursPerDay; el('yHours').value=state.yHours;
      el('useHours').value=state.useHours; syncUseHoursRange();
      syncSalaryRange();
      updateVisibility();
      updateView();

      const year = new Date().getFullYear();
      el('creditText').textContent = `Copyright (c) ${year} 税理士法人松本会計事務所 All Rights Reserved. / ${VERSION}`;

      // デバッグバッジ
      const hash = (location.hash||'').toLowerCase();
      if(hash.includes('debug')){
        const badge=document.createElement('div');
        badge.style.cssText='position:fixed;top:6px;right:6px;background:#10b981;color:#fff;padding:4px 6px;border-radius:6px;font-size:12px;z-index:9999;';
        badge.textContent='init ok: '+VERSION;
        document.body.appendChild(badge);
      }
    }catch(err){
      console.error(err);
      const div = document.createElement('div');
      div.className='toast';
      div.style.background='#fff3cd'; div.style.color='#856404'; div.style.border='1px solid #ffeeba';
      div.textContent='初期化エラー。ブラウザのConsoleを確認してください。';
      document.body.appendChild(div); setTimeout(()=>div.remove(), 4000);
    }
  }
  if(document.readyState==='interactive' || document.readyState==='complete'){ init(); }
  document.addEventListener('DOMContentLoaded', init);
})();
</script>
</body>
</html>
